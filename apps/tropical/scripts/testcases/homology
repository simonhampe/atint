# This script tests the conjecture that the first homology of the canonical complex is independent of the 
# choice of refinement

use application "common";
use application "tropical";
use application "fan";
use Benchmark qw(:all);

my $testNumber = 100; #Number of random tropical varieties computed
my $refinements = 100; #Number of random refinements computed for each variety
my $ambient_dim = 3;
my $eqnumber = 10; # The higher the more complicated the varieties become
my $coeffbound = 5; # The higher the more 'distributed' a variety becomes

for(my $t = 1; $t <= $testNumber; $t++) {
  my @a = tropical::random_minmaxdivisor($ambient_dim, $eqnumber, $coeffbound, 0);
  my $variety = $a[1];
  my $prechar = $variety->characteristic;
  my $terminate = 0;
  for(my $r = 1; $r <= $refinements; $r++) {
    my $func = tropical::random_minmaxdivisor($ambient_dim, $eqnumber, $coeffbound,1);
    my $refvar = tropical::intersect_complete_fan($variety, $func->linearityDomains);
    if($refvar->characteristic != $prechar) {
      print "Conjecture is false! Saving example...\n";
      save($a[0],"badfunction");
      save($func,"badrefinement");
      $terminate = 1;
      last;
    }  
  }
  if($terminate == 1) {
      last;
  }
}